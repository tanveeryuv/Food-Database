<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Food Products Database</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
.dropdown {
  position: relative;
  display: inline-block;
}
.dropdown-content {
  display: none;
  position: absolute;
  background: white;
  border: 1px solid #ccc;
  padding: 10px;
  z-index: 1;
}
.dropdown:hover .dropdown-content {
  display: block;
}
.accordion {
  cursor: pointer;
  background: #ccc;
  color: black;
  padding: 5px;
  border: none;
  text-align: left;
  width: 100%;
}
.panel {
  display: none;
  padding: 10px;
  background: #ccc;
}
</style>
<body class="p-4">
  <h1>Food Products Database</h1>
  <form method="POST" class="row g-3 mb-4">
    <div class="dropdown">
      <button type="button">Select Categories ▼</button>
      <div class="dropdown-content">
        {% for c in categories %}
          <label><input type="checkbox" name="category" value="{{ c }}" {% if "{{ c }}" 
            in request.args.getlist("category") %}checked{% endif %}>{{ c }}</label><br>
        {% endfor %}
      </div>
    </div>
    <div class="dropdown">
      <button type="button">Select Countries ▼</button>
      <div class="dropdown-content">
        {% for c in countries %}
          <label><input type="checkbox" name="country" value="{{ c }}" {% if "{{ c }}" 
            in request.args.getlist("country") %}checked{% endif %}>{{ c }}</label><br>
        {% endfor %}
      </div>
    </div>
    <div class="col-md-2">
      <label>Min Calories</label>
      <input type="number" step="0.1" name="min_calories" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Max Calories</label>
      <input type="number" step="0.1" name="max_calories" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Min Protein</label>
      <input type="number" step="0.1" name="min_protein" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Max Protein</label>
      <input type="number" step="0.1" name="max_protein" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Min Sugar</label>
      <input type="number" step="0.1" name="min_sugar" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Max Sugar</label>
      <input type="number" step="0.1" name="max_sugar" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Min Fat</label>
      <input type="number" step="0.1" name="min_fat" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Max Fat</label>
      <input type="number" step="0.1" name="max_fat" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Min Salt</label>
      <input type="number" step="0.1" name="min_salt" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Max Salt</label>
      <input type="number" step="0.1" name="max_salt" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Min Fiber</label>
      <input type="number" step="0.1" name="min_fiber" class="form-control">
    </div>
    <div class="col-md-2">
      <label>Max Fiber</label>
      <input type="number" step="0.1" name="max_fiber" class="form-control">
    </div>

    <div class="col-12 mt-2">
      <button class="btn btn-primary" type="submit">Filter</button>
    </div>
  </form>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Brand</th>
        <th>Category</th>
        <th>Calories</th>
        <th>Fat</th>
        <th>Sugar</th>
        <th>Protein</th>
        <th>Image</th>
      </tr>
    </thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td>{{ p[0] }}</td>
        <td>{{ p[1] }}</td>
        <td>{{ p[2] }}</td>
        <td>{{ p[3] }}</td>
        <td>{{ p[4] }}</td>
        <td>{{ p[5] }}</td>
        <td>{{ p[6] }}</td>
        <td>
        {% if p[7] %}
            <img src="{{ p[7] }}" alt="{{ p[0] }}" style="max-width:50px;">
        {% else %}
            <span>No image available</span>
        {% endif %}
        </td>
        <td>
          <button class="accordion">More Info</button>
          <div class="panel">
            <p>Salt: {{p[8]}}</p>
            <p>Fiber: {{p[9]}}</p>
            <p>Country: {{p[10]}}</p>
            <p>Insights: {{p[11]}}</p>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
<script>
document.querySelectorAll(".accordion").forEach(btn => {
  btn.addEventListener("click", () => {
    const panel = btn.nextElementSibling;
    panel.style.display = (panel.style.display === "block") ? "none" : "block";
  });
});
</script>
</html>
